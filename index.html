<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>wedoBox.com.tw ï½œ æ ¼ç©ç¶­åº¦ç®¡ç†ç³»çµ±</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta property="og:title" content="wedoBox.com.tw">
<meta property="og:description" content="æ ¼ç©ç¶­åº¦å°ˆç”¨ç®¡ç†ç³»çµ±">
<meta property="og:url" content="https://wedoBox.com.tw">

<meta name="apple-mobile-web-app-title" content="wedoBox">
<meta name="apple-mobile-web-app-capable" content="yes">

<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

<style>
/* æ ¸å¿ƒé…è‰² - 100% åŸå§‹éœ“è™¹ç‰ˆï¼Œä¸æ”¹å‹•ä»»ä½•æ¨£å¼ */
:root { --primary: #0d1117; --accent: #00d2ff; --success: #39ff14; --danger: #ff3131; --warning: #ffcc00; --bg: #0d1117; --card-bg: rgba(22, 27, 34, 0.9); }

body { 
    font-family: "Microsoft JhengHei", sans-serif; 
    margin: 0; padding: 1rem; 
    background: var(--bg); color: #e6edf3; 
    background-image: radial-gradient(circle at 50% 50%, #161b22 0%, #0d1117 100%); 
    min-height: 100vh; 
}

/* ... ä»¥ä¸‹ç‚ºæ‚¨åŸå§‹çš„æ‰€æœ‰ CSS æ¨£å¼èˆ‡å‹•ç•«ï¼Œå‡å®Œå…¨ä¿ç•™ ... */
h1, h2 { text-align: center; text-shadow: 0 0 10px var(--accent); color: var(--accent); }
@keyframes mega-shake { 0% { transform: translate(0,0) rotate(0deg); } 10% { transform: translate(-8px, -8px) rotate(-2deg); } 100% { transform: translate(0,0) rotate(0); } }
@keyframes flash-red { 0%, 100% { background: rgba(13, 17, 23, 1); } 50% { background: rgba(150, 0, 0, 1); } }
@keyframes zoom-in-out { 0% { transform: scale(0.5); opacity: 0; } 50% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
.shake-heavy { animation: mega-shake 0.3s cubic-bezier(.36,.07,.19,.97) both; border-color: var(--danger) !important; }
.flash-screen { animation: flash-red 0.2s infinite; }
#backBtn { position: fixed; top: 15px; left: 15px; width: 50px; height: 50px; border-radius: 50%; background: rgba(22, 27, 34, 0.85); color: var(--accent); display: none; z-index: 999; border: 2px solid var(--accent); font-size: 24px; cursor: pointer; align-items: center; justify-content: center; }
.logout-btn { position: fixed; top: 15px; right: 15px; background: var(--danger); padding: 10px 18px; border-radius: 10px; font-weight: bold; color: #fff; border: none; z-index: 998; cursor: pointer; display: none; }
#loginOverlay { position: fixed; inset: 0; background: #0d1117; display: flex; justify-content: center; align-items: center; z-index: 9999; }
.login-box { background: #161b22; padding: 2rem; border-radius: 20px; text-align: center; width: 300px; border: 2px solid var(--accent); position: relative; }
.pw-screen { background: #000; font-size: 2.2rem; padding: 15px; border-radius: 12px; margin-bottom: 20px; color: var(--accent); min-height: 45px; letter-spacing: 5px; border: 1px solid var(--accent); display: flex; justify-content: center; align-items: center; }
.lock-overlay { position: absolute; inset: 0; background: rgba(20, 0, 0, 0.95); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 100; border-radius: 20px; border: 3px solid var(--danger); }
.count-num { font-size: 6rem; font-weight: 900; color: white; animation: zoom-in-out 1s infinite; }
.numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
.num-btn { background: #1c2128; border: 1px solid #30363d; padding: 18px; font-size: 1.4rem; border-radius: 15px; color: #fff; cursor: pointer; }
.grid { display: grid; gap: 12px; width: 100%; max-width: 1200px; margin: 1.5rem auto; grid-template-columns: repeat(5, 1fr); }
.cell { background: var(--card-bg); border-radius: 12px; padding: 1rem 0.5rem; text-align: center; cursor: pointer; display: flex; flex-direction: column; justify-content: center; min-height: 85px; border: 1px solid #30363d; }
.cell.empty { border: 1px dashed var(--accent); color: var(--accent); }
.cell.occupied { border: 1px solid var(--success); color: var(--success); }
.detail { max-width: 700px; margin: 20px auto 100px auto; background: var(--card-bg); padding: 1.5rem; border-radius: 16px; border: 1px solid #30363d; }
.row { display: grid; gap: 8px; margin-bottom: 1rem; background: rgba(255,255,255,0.03); padding: 10px; border-radius: 8px; }
input, select { padding: 0.7rem; border-radius: 8px; background: #1c2128; border: 1px solid #30363d; color: #ffffff; width: 100%; box-sizing: border-box; font-size: 1rem; }
button.action { padding: 0.8rem 1.2rem; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: #fff; width: 100%; }
.primary { background: linear-gradient(45deg, #00d2ff, #3a7bd5); }
.success { background: linear-gradient(45deg, #27ae60, #2ecc71); }
.danger { background: linear-gradient(45deg, #e74c3c, #c0392b); }
.display-label { background: rgba(255,255,255,0.05); color: var(--accent); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; border: 1px solid #30363d; height: 38px; }
.remove-btn { background: #441111; color: #ff5555; border: 1px solid #ff3131; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; }
</style>
</head>

<body onkeydown="handleGlobalKey(event)">

<div id="loginOverlay">
    <div class="login-box" id="loginBox">
        <div id="lockOverlay" class="lock-overlay">
            <div id="countDisplay" class="count-num"></div>
        </div>
        <div style="color:var(--accent); font-size:0.8rem; margin-bottom:5px; opacity:0.8;">wedoBox.com.tw</div>
        <h2>æ ¼ç©ç¶­åº¦ç®¡ç†ç³»çµ±</h2>
        <div id="pwDisplay" class="pw-screen"></div>
        <div class="numpad">
            <button class="num-btn" onclick="press('1')">1</button>
            <button class="num-btn" onclick="press('2')">2</button>
            <button class="num-btn" onclick="press('3')">3</button>
            <button class="num-btn" onclick="press('4')">4</button>
            <button class="num-btn" onclick="press('5')">5</button>
            <button class="num-btn" onclick="press('6')">6</button>
            <button class="num-btn" onclick="press('7')">7</button>
            <button class="num-btn" onclick="press('8')">8</button>
            <button class="num-btn" onclick="press('9')">9</button>
            <button class="num-btn" style="color:var(--danger)" onclick="resetPw()">C</button>
            <button class="num-btn" onclick="press('0')">0</button>
            <button class="num-btn" style="color:var(--success)" onclick="loginCheck()">OK</button>
        </div>
    </div>
</div>

<button id="backBtn" onclick="goBack()">â†</button>
<button id="mainLogoutBtn" class="logout-btn" onclick="logout()">ç™»å‡º</button>

<div id="mainUI" style="display:none">
    <h1 id="pageTitle">wedoBox ç®¡ç†æ¨¡å¼</h1>
    
    <div id="gridPage" class="grid"></div>
    <div id="detailPage" class="detail" style="display:none">
        <h2 id="dCode"></h2>
        <div id="products"></div>
        <button class="action primary" style="margin-bottom:1rem" onclick="addProduct()">ï¼‹ æ–°å¢å•†å“</button>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:1.5rem;">
            <input id="dOwner" placeholder="å§“å">
            <input id="dContact" placeholder="é›»è©±">
            <input id="dRent" type="number" placeholder="ç§Ÿé‡‘">
            <input id="dSignDate" placeholder="ç°½ç´„æ—¥" onblur="autoFormatDate(this)">
            <input id="dPeriod" placeholder="åˆ°æœŸæ—¥" onblur="autoFormatDate(this)" style="grid-column: span 2;">
        </div>
        <button class="action success" onclick="saveDetail()">ğŸ’¾ å„²å­˜è®Šæ›´</button>
    </div>
</div>

<script>
/* ... ä»¥ä¸‹ç‚ºæ‚¨åŸå§‹çš„æ‰€æœ‰ JavaScript é‚è¼¯ï¼ŒåŒ…å«éµç›¤è¼¸å…¥ã€åˆ®å¡/å±•ç¤ºåˆ‡æ›ã€è‡ªå‹•æ ¼å¼åŒ–æ—¥æœŸã€éœ‡å‹•é–å®šç­‰ï¼Œå‡å®Œå…¨ä¿ç•™ ... */
let data = JSON.parse(localStorage.getItem("gw_data")) || [];
let currentZone = null, currentItem = null, tempPw = "", loginType = "", errorCounter = 0, isLocked = false;

function press(n) { if(!isLocked && tempPw.length < 4) { tempPw += n; updateDisplay(); } }
function resetPw() { tempPw = ""; updateDisplay(); }
function updateDisplay() { document.getElementById('pwDisplay').innerText = "â€¢".repeat(tempPw.length); }

function loginCheck() {
    if(isLocked) return;
    const box = document.getElementById('loginBox');
    if (tempPw === "1688") startApp("boss");
    else if (tempPw === "6969") startApp("staff");
    else if (tempPw === "9527") startApp("owner");
    else {
        errorCounter++;
        box.classList.add('shake-heavy');
        setTimeout(() => { box.classList.remove('shake-heavy'); if(errorCounter>=3){triggerLockdown();} else {resetPw();} }, 500);
    }
}

function triggerLockdown() {
    isLocked = true; errorCounter = 0;
    const overlay = document.getElementById('lockOverlay');
    overlay.style.display = 'flex';
    let timeLeft = 5;
    const timer = setInterval(() => {
        document.getElementById('countDisplay').innerText = timeLeft;
        if (timeLeft <= 0) { clearInterval(timer); overlay.style.display = 'none'; isLocked = false; resetPw(); }
        timeLeft--;
    }, 1000);
}

function handleGlobalKey(e) {
    if (document.getElementById('loginOverlay').style.display !== "none") {
        if (/[0-9]/.test(e.key)) press(e.key);
        if (e.key === "Enter") loginCheck();
        if (e.key === "Backspace") resetPw();
    }
}

function startApp(type) {
    loginType = type;
    document.getElementById('loginOverlay').style.display = "none";
    document.getElementById('mainUI').style.display = "block";
    document.getElementById('mainLogoutBtn').style.display = "block";
    initData(); showZones();
}

function initData() {
    const config = { "A": 60, "B": 20, "C": 20, "D": 20 };
    Object.keys(config).forEach(z => {
        if (data.filter(d => d.zone === z).length === 0) {
            for (let i = 1; i <= config[z]; i++) data.push({ zone: z, number: i, products: [], owner: "", contact: "", rent: "", period: "", signDate: "" });
        }
    });
}

function showZones() {
    currentZone = null; gridPage.innerHTML = ""; detailPage.style.display = "none"; gridPage.style.display = "grid";
    document.getElementById('backBtn').style.display = "none";
    ["A", "B", "C", "D"].forEach(z => {
        const div = document.createElement("div"); div.className = `cell empty`;
        div.innerHTML = `<b>${z} å€</b>`;
        div.onclick = () => openZone(z); gridPage.appendChild(div);
    });
}

function openZone(z) {
    currentZone = z; gridPage.innerHTML = ""; document.getElementById('backBtn').style.display = "flex";
    data.filter(d => d.zone === z).forEach(item => {
        const c = document.createElement("div"); const code = getCode(item);
        c.className = item.owner ? 'cell occupied' : 'cell';
        if(z === "A" || z === "B") {
            const parts = code.split("-");
            c.innerHTML = `<div>${parts[0]}</div><div>${parts[1]}</div>`;
        } else { c.innerHTML = `<b>${code}</b>`; }
        c.onclick = () => openDetail(item, code); gridPage.appendChild(c);
    });
}

function getCode(item) {
    if (item.zone === "A" || item.zone === "B") {
        const r = Math.floor((item.number - 1) / 5) + 1, col = ((item.number - 1) % 5) + 1;
        return `${item.zone}${String(r).padStart(2, "0")}-${String(col).padStart(2, "0")}`;
    }
    return `${item.zone}${String(item.number).padStart(2, "0")}`;
}

function handleTypeChange(newType, index) {
    const p = currentItem.products[index];
    p.type = newType;
    p.price = (newType === "å±•ç¤º") ? "å±•ç¤ºä¸­" : "";
    p.total = "";
    renderProducts();
}

function renderProducts() {
    const pDiv = document.getElementById('products'); pDiv.innerHTML = "";
    currentItem.products.forEach((p, i) => {
        const r = document.createElement("div"); r.className = "row";
        let inner = `<input value="${p.name||''}" oninput="currentItem.products[${i}].name=this.value" placeholder="å“å">
                     <select onchange="handleTypeChange(this.value, ${i})">
                        <option value="ç›´å”®" ${p.type==='ç›´å”®'?'selected':''}>ç›´å”®</option>
                        <option value="åˆ®å¡" ${p.type==='åˆ®å¡'?'selected':''}>åˆ®å¡</option>
                        <option value="å±•ç¤º" ${p.type==='å±•ç¤º'?'selected':''}>å±•ç¤º</option>
                     </select>`;

        if (p.type === "åˆ®å¡") {
            r.style.gridTemplateColumns = "1fr 1fr 1fr 1fr 35px";
            inner += `<input type="number" placeholder="æ ¼" value="${p.total||''}" oninput="currentItem.products[${i}].total=this.value">
                      <input type="number" placeholder="åƒ¹" value="${p.price||''}" oninput="currentItem.products[${i}].price=this.value">`;
        } else if (p.type === "å±•ç¤º") {
            r.style.gridTemplateColumns = "1fr 1fr 2fr 35px";
            inner += `<div class="display-label">å±•ç¤ºä¸­</div>`;
        } else {
            r.style.gridTemplateColumns = "1fr 1fr 2fr 35px";
            inner += `<input type="number" placeholder="åƒ¹" value="${p.price||''}" oninput="currentItem.products[${i}].price=this.value">`;
        }
        inner += `<button class="remove-btn" onclick="currentItem.products.splice(${i},1);renderProducts()">âœ•</button>`;
        r.innerHTML = inner; pDiv.appendChild(r);
    });
}

function addProduct() { currentItem.products.push({ name: "", type: "ç›´å”®", price: "", total: "" }); renderProducts(); }
function openDetail(item, code) { 
    currentItem = item; dCode.innerText = code; 
    dOwner.value = item.owner; dContact.value = item.contact; dRent.value = item.rent; dSignDate.value = item.signDate; dPeriod.value = item.period;
    renderProducts(); gridPage.style.display = "none"; detailPage.style.display = "block"; 
}
function saveDetail() {
    currentItem.owner = dOwner.value; currentItem.contact = dContact.value; currentItem.rent = dRent.value; currentItem.signDate = dSignDate.value; currentItem.period = dPeriod.value;
    localStorage.setItem("gw_data", JSON.stringify(data)); goBack();
}
function goBack() { if (detailPage.style.display === "block") { detailPage.style.display = "none"; gridPage.style.display = "grid"; openZone(currentZone); } else { showZones(); } }
function autoFormatDate(i) { let v = i.value.replace(/\D/g, ''); if (v.length === 8) i.value = v.substring(0, 4) + "/" + v.substring(4, 6) + "/" + v.substring(6, 8); }
function logout() { location.reload(); }
</script>
</body>
</html>
